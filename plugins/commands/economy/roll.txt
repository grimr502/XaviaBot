import crypto from "crypto";

const config = {
  name: "roll",
  aliases: ["dice"],
  description: "Roll a dice",
  usage: "<bet amount>",
  cooldown: 20,
  credits: "TakiUwU"
};

const langData = {
  "en_US": {
    "roll.invalidAmount": "ğ™¸ğš—ğšŸğšŠğš•ğš’ğš ğš‹ğšğš ğšŠğš–ğš˜ğšğš—ğš.",
    "roll.insufficientBalance": "ğšˆğš˜ğš ğšğš˜ğš—'ğš ğš‘ğšŠğšŸğš ğšğš—ğš˜ğšğšğš‘ ğš–ğš˜ğš—ğšğš¢ ğšğš˜ ğš™ğš•ğšŠğšŒğš ğšğš‘ğšŠğš ğš‹ğšğš.",
    "roll.result": "ã€”ğšˆğš˜ğš ğš›ğš˜ğš•ğš•ğšğš ğšŠ âŒœ{result}âŒŸã€•!\n        {message}"
  },
  "vi_VN": {
    "roll.invalidAmount": "Sá»‘ tiá»n Ä‘áº·t cÆ°á»£c khÃ´ng há»£p lá»‡.",
    "roll.insufficientBalance": "Báº¡n khÃ´ng Ä‘á»§ tiá»n Ä‘á»ƒ Ä‘áº·t cÆ°á»£c.",
    "roll.result": "Báº¡n Ä‘Ã£ tung Ä‘Æ°á»£c {result}! {message}"
  }
};

async function onCall({ message, args, getLang }) {
  const { Users } = global.controllers;
  const amount = parseInt(args[0]);

  if (isNaN(amount) || amount <= 0) {
    return message.reply(getLang("roll.invalidAmount"));
  }

  try {
    const userBalance = await Users.getMoney(message.senderID);

    if (userBalance == null || userBalance < amount) {
      return message.reply(getLang("roll.insufficientBalance"));
    }

    // Generate a cryptographically secure random number between 1 and 6 (inclusive)
    const buffer = crypto.randomBytes(1);
    const rollResult = buffer[0] % 6 + 1;

    const isWin = rollResult === 1;
    let winnings;
    let resultMessage;

    if (isWin) {
      winnings = -amount;
      resultMessage = getLang("roll.result", {
        result: rollResult,
        message: `ğšˆğš˜ğš ğš•ğš˜ğšœğš $${amount}. ğŸ’¸`
      });
    } else {
      winnings = amount * 1;
      resultMessage = getLang("roll.result", {
        result: rollResult,
        message: `ğšˆğš˜ğš ğš ğš˜ğš— $${winnings}! ğŸ’µ`
      });
    }

    await Users.increaseMoney(message.senderID, winnings);

    message.reply(resultMessage);
  } catch (error) {
    console.error(error);
    return message.reply(getLang("any.error"));
  }
}

export default {
  config,
  langData,
  onCall
};
